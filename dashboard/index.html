<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NDXP433F');</script>
    <!-- End Google Tag Manager -->
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T&S Policy Watcher - Market Intelligence & Risk Assessment Platform</title>
    
    <!-- Meta Description & SEO -->
    <meta name="description" content="Real-time monitoring of Trust & Safety policies across TikTok, Meta, YouTube, Whatnot, and Twitch. Stay ahead of policy changes that could impact your business.">
    <meta name="keywords" content="trust and safety, policy monitoring, TikTok, Meta, YouTube, Whatnot, Twitch, compliance, risk assessment">
    <meta name="author" content="Policy Watch">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://ts-policy-watcher.vercel.app/">
    <meta property="og:title" content="T&S Policy Watcher - Real-time Policy Monitoring">
    <meta property="og:description" content="Monitor Trust & Safety policy changes across major platforms. Get instant alerts when policies update.">
    <meta property="og:site_name" content="T&S Policy Watcher">
    <meta property="og:image" content="https://ts-policy-watcher.vercel.app/og-image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://ts-policy-watcher.vercel.app/">
    <meta property="twitter:title" content="T&S Policy Watcher - Real-time Policy Monitoring">
    <meta property="twitter:description" content="Monitor Trust & Safety policy changes across major platforms. Get instant alerts when policies update.">
    <meta property="twitter:image" content="https://ts-policy-watcher.vercel.app/og-image.png">
    
    <!-- Favicon - Shield Icon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23007aff'><path d='M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z'/></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23007aff'><path d='M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z'/></svg>">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#007aff">
    <meta name="msapplication-TileColor" content="#007aff">
    
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NDXP433F"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <header>
        <div class="header-content">
            <div class="header-left">
                <h1><i class="fas fa-shield-alt"></i> T&S Policy Watcher</h1>
                <p>Market Intelligence & Risk Assessment Platform</p>
            </div>
            <div class="header-right">
                <div class="header-status-bar">
                    <div class="status-item">
                        <span class="status-number" id="header-total-policies">-</span>
                        <span class="status-label">Policies Tracked</span>
                    </div>
                    <div class="status-item" id="header-system-status">
                        <span class="status-number" id="header-status-number">-</span>
                        <span class="status-label" id="header-status-label">Minutes to Next Check</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Newsletter Chat Widget -->
    <div class="newsletter-widget visible" id="newsletterWidget">
        <button class="widget-trigger" onclick="toggleWidget()" id="widgetTrigger">
            <i class="fas fa-envelope-open-text"></i>
        </button>
        <div class="widget-form expanded" id="widgetForm">
            <div class="widget-header">
                <div class="widget-title">
                    <i class="fas fa-envelope-open-text"></i>
                    <h3>Subscribe to Alerts</h3>
                </div>
                <button class="widget-close" onclick="toggleWidget()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <p class="widget-subtitle">Get notified when platform policies change that could impact your business.</p>
            <div class="widget-input-group">
                <input type="email" id="widgetEmail" placeholder="your@email.com" required />
                <button onclick="subscribeFromWidget()" id="widgetSubscribeBtn">Subscribe</button>
            </div>
            <div class="widget-validation" id="widgetValidation" style="display: none;">
                <i class="fas fa-exclamation-triangle"></i>
                <span>Please enter a valid email address</span>
            </div>
            <div class="widget-privacy">
                <i class="fas fa-shield-alt"></i>
                <span>We will never share your email. Unsubscribe anytime.</span>
            </div>
        </div>
    </div>

    <nav class="main-nav">
        <button class="nav-tab active" data-tab="matrix">
            <i class="fas fa-table"></i> Policy Matrix
        </button>
        <button class="nav-tab" data-tab="weekly">
            <i class="fas fa-calendar-week"></i> Weekly Update
        </button>
        <button class="nav-tab" data-tab="platforms">
            <i class="fas fa-building"></i> Policy Explorer
        </button>
        <button class="nav-tab" data-tab="analytics">
            <i class="fas fa-chart-line"></i> Analytics & Logs
        </button>
    </nav>

    <!-- Health Alert Banner -->
    <div class="health-alert-banner" id="health-alert-banner" style="display: none;">
        <div class="alert-content">
            <div class="alert-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="alert-message">
                <h4>URL Health Issues Detected</h4>
                <p id="health-alert-text">Some policy URLs are currently inaccessible.</p>
            </div>
            <div class="alert-actions">
                <button class="alert-dismiss" onclick="dismissHealthAlert()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>

    <main>
        <!-- Policy Matrix Tab -->
        <section id="matrix" class="tab-content active">
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-table"></i> Policy Matrix</h2>
                    <div class="matrix-controls">
                        <button class="export-btn" onclick="exportMatrix()">
                            <i class="fas fa-download"></i> Export CSV
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="matrix-table-container">
                        <table id="policy-matrix-table" class="matrix-table">
                            <thead>
                                <tr>
                                    <th>Platform</th>
                                    <th>Policy Name</th>
                                    <th>Status</th>
                                    <th>Coverage Areas</th>
                                    <th>Key Features</th>
                                    <th>Enforcement Actions</th>
                                    <th>Last Updated</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="matrix-tbody">
                                <!-- Matrix content will be dynamically populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Weekly Update Tab -->
        <section id="weekly" class="tab-content">
            <div class="weekly-header">
                <div class="weekly-header-main">
                    <h2><i class="fas fa-calendar-week"></i> Weekly Policy Summary</h2>
                    <div class="weekly-controls">
                        <select id="week-selector" class="week-selector">
                            <option value="">Loading weeks...</option>
                        </select>
                    </div>
                </div>
                <div class="weekly-metadata" id="weekly-metadata">
                    <!-- Run metadata will be populated by JS -->
                </div>
            </div>
            
            <div class="weekly-content">
                <div class="card weekly-summary-card full-width">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-bar"></i> Summary</h3>
                    </div>
                    <div class="card-body">
                        <div id="weekly-summary-content">
                            <div class="loading-state">
                                <i class="fas fa-spinner fa-spin"></i>
                                <p>Loading weekly summary...</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="weekly-stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="weekly-changes-count">-</div>
                            <div class="stat-label">Policy Changes</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-building"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="weekly-platforms-count">-</div>
                            <div class="stat-label">Platforms Affected</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="weekly-run-date">-</div>
                            <div class="stat-label">Last Generated</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Policy Explorer Tab -->
        <section id="platforms" class="tab-content">
            <!-- Block/Mute Focus Section -->
            <div class="block-mute-section" id="block-mute-section">
                <!-- Block/Mute content will be populated by JS -->
            </div>

            <div class="platform-selector" id="platform-selector">
                <div class="platform-tabs" id="platform-tabs">
                    <!-- Platform tabs will be populated by JS -->
                </div>
            </div>
            <!-- Spacer to prevent content jump when platform selector becomes sticky -->
            <div class="platform-selector-spacer" id="platform-selector-spacer"></div>
            <div class="platform-content-wrapper" id="platform-content-wrapper">
                <div class="platform-content" id="platform-content">
                    <!-- Platform-specific policies will be populated by JS -->
                </div>
            </div>
        </section>

        <!-- Analytics Tab -->
        <section id="analytics" class="tab-content">
            <!-- Weekly Change Frequency Chart - Top Priority -->
            <div class="card full-width">
                <div class="card-header">
                    <h2><i class="fas fa-chart-line"></i> Weekly Unique Policy Changes by Platform</h2>
                </div>
                <div class="card-body">
                    <div id="weekly-platform-chart"></div>
                </div>
            </div>
            
            <!-- Recent Policy Changes Card -->
            <div class="card recent-changes-card full-width">
                <div class="card-header">
                    <h2><i class="fas fa-history"></i> Recent Policy Changes</h2>
                </div>
                <div class="card-body">
                    <div id="recent-changes-list">Loading...</div>
                </div>
            </div>
            
            <!-- Secondary Analytics Grid -->
            <div class="analytics-grid">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-clock"></i> Run Performance Trends</h2>
                    </div>
                    <div class="card-body">
                        <div id="performance-timeline"></div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-chart-bar"></i> Platform Activity Overview</h2>
                    </div>
                    <div class="card-body">
                        <div id="platform-activity-chart"></div>
                    </div>
                </div>
            </div>
            
            <!-- System Logs Section -->
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-server"></i> System Run Logs</h2>
                    <div class="filter-controls">
                        <select id="history-filter">
                            <option value="all">All Runs</option>
                            <option value="success">Successful Only</option>
                            <option value="failure">Failures Only</option>
                        </select>
                    </div>
                </div>
                <div class="card-body">
                    <div id="history-table-container" class="history-table-container">
                        <table id="history-table">
                            <thead>
                                <tr>
                                    <th>Timestamp</th>
                                    <th>Status</th>
                                    <th>Pages Checked</th>
                                    <th>Changes Found</th>
                                    <th>Errors</th>
                                    <th>Time Ago</th>
                                </tr>
                            </thead>
                            <tbody id="history-tbody">
                                <!-- History rows will be populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <script src="script.js"></script>

    <!-- Run Log Modal -->
    <div id="run-log-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-history"></i> System Run Log</h2>
                <span class="close-button">&times;</span>
            </div>
            <div class="modal-body">
                <div id="run-log-container">Loading log...</div>
            </div>
        </div>
    </div>

    <!-- Policy Summary Modal -->
    <div id="policy-summary-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="policy-modal-title"><i class="fas fa-file-text"></i> Policy Summary</h2>
                <span class="close-button" onclick="closePolicyModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="policy-modal-content">Loading...</div>
                <div class="modal-actions">
                    <a id="policy-modal-visit" href="#" target="_blank" class="action-btn primary-btn">
                        <i class="fas fa-external-link-alt"></i> Visit Policy Page
                    </a>
                    <a id="policy-modal-history" href="#" target="_blank" class="action-btn secondary-btn">
                        <i class="fas fa-clock"></i> View History
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Policy History Modal -->
    <div id="policy-history-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="policy-history-title"><i class="fas fa-clock"></i> Policy History</h2>
                <span class="close-button" onclick="closePolicyHistoryModal()">&times;</span>
            </div>
            <div class="modal-body history-modal-body">
                <div class="history-version-list">
                    <div id="policy-history-list" class="history-placeholder">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading historyâ€¦</p>
                    </div>
                </div>
                <div class="history-entry-content" id="policy-history-content">
                    <div class="history-placeholder">
                        <i class="fas fa-info-circle"></i>
                        <p>Select a version to view the cleaned snapshot.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>



</body>
</html>
